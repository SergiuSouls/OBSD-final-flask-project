<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å - –ú–∞–≥–∞–∑–∏–Ω –ü–ö</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>‚öôÔ∏è –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h1>

        <nav>
            <a href="/">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a href="/shop">–¢–æ–≤–∞—Ä–∏</a>
            <a href="/admin">–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</a>
        </nav>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="message {{ category }}">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –Ω–∏–∑—å–∫—ñ –∑–∞–ª–∏—à–∫–∏ -->
        {% if low_stock %}
        <div style="background: #fed7d7; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h2 style="color: #742a2a; margin-bottom: 15px;">‚ö†Ô∏è –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –Ω–∏–∑—å–∫—ñ –∑–∞–ª–∏—à–∫–∏</h2>
            <table>
                <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–ó–∞–ª–∏—à–æ–∫</th>
                        <th>–î–∞—Ç–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</th>
                        <th>–î—ñ—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alert in low_stock %}
                    <tr>
                        <td>{{ alert.product_name }}</td>
                        <td style="color: #e53e3e; font-weight: bold;">{{ alert.current_quantity }} —à—Ç</td>
                        <td>{{ alert.alert_date.strftime('%d.%m.%Y %H:%M') }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('restock', product_id=alert.product_id) }}" style="display: flex; gap: 10px;">
                                <input type="number" name="quantity" min="1" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" style="width: 100px;" required>
                                <button type="submit" class="btn" style="padding: 8px 15px;">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- –¢–æ–ø —Ç–æ–≤–∞—Ä—ñ–≤ -->
        <div style="margin: 30px 0;">
            <h2>üèÜ –¢–æ–ø-5 —Ç–æ–≤–∞—Ä—ñ–≤ –∑–∞ –ø—Ä–æ–¥–∞–∂–∞–º–∏</h2>
            <table>
                <thead>
                    <tr>
                        <th>–ú—ñ—Å—Ü–µ</th>
                        <th>–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É</th>
                        <th>–ü—Ä–æ–¥–∞–Ω–æ —Ä–∞–∑—ñ–≤</th>
                        <th>–í–∏—Ä—É—á–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in top_products %}
                    <tr>
                        <td>
                            {% if product.rank == 1 %}ü•á
                            {% elif product.rank == 2 %}ü•à
                            {% elif product.rank == 3 %}ü•â
                            {% else %}{{ product.rank }}
                            {% endif %}
                        </td>
                        <td>{{ product.product_name }}</td>
                        <td>{{ product.times_sold }}</td>
                        <td style="color: #48bb78; font-weight: bold;">${{ product.total_revenue }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑–∞ 30 –¥–Ω—ñ–≤ -->
        <div style="margin: 30px 0;">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂—ñ–≤ (30 –¥–Ω—ñ–≤)</h2>
            <table>
                <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–ü—Ä–æ–¥–∞–Ω–æ</th>
                        <th>–í–∏—Ä—É—á–∫–∞</th>
                        <th>–û—Å—Ç–∞–Ω–Ω—ñ–π –ø—Ä–æ–¥–∞–∂</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in sales_stats %}
                    <tr>
                        <td>{{ stat.product_name }}</td>
                        <td>{{ stat.total_sold }} —à—Ç</td>
                        <td style="color: #48bb78; font-weight: bold;">${{ stat.total_revenue }}</td>
                        <td>{{ stat.last_sale_date.strftime('%d.%m.%Y %H:%M') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Ü—ñ–Ω -->
        <div style="margin: 30px 0;">
            <h2>üí∞ –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Ü—ñ–Ω (–æ—Å—Ç–∞–Ω–Ω—ñ 10)</h2>
            <table>
                <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–°—Ç–∞—Ä–∞ —Ü—ñ–Ω–∞</th>
                        <th>–ù–æ–≤–∞ —Ü—ñ–Ω–∞</th>
                        <th>–ó–º—ñ–Ω–∞</th>
                        <th>–î–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for price in price_history %}
                    <tr>
                        <td>{{ price.name }}</td>
                        <td>${{ price.old_price }}</td>
                        <td>${{ price.new_price }}</td>
                        <td>
                            {% if price.new_price < price.old_price %}
                                <span style="color: #48bb78;">‚Üì ${{ (price.old_price - price.new_price)|round(2) }}</span>
                            {% else %}
                                <span style="color: #e53e3e;">‚Üë ${{ (price.new_price - price.old_price)|round(2) }}</span>
                            {% endif %}
                        </td>
                        <td>{{ price.changed_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏ -->
        <div style="margin: 30px 0;">
            <a href="/admin/sales-log" class="btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ–≤–Ω–∏–π –ª–æ–≥ –ø—Ä–æ–¥–∞–∂—ñ–≤</a>
        </div>
    </div>
</body>
</html>